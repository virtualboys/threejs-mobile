<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<meta name="HandheldFriendly" content="true" />

	<title>Touch pad control test</title>

	<link rel="icon" type="image/x-icon" href="./images/favicon.ico">

	<link rel="stylesheet" href="./css/touch-pad.css">
	<link rel="stylesheet" href="./css/main.css">
	<link rel="stylesheet" href="./css/loading.css">
	<link rel="stylesheet" href="./css/loading-bar.css">
</head>

<body>
	<section id="loading-screen">
		<div id="loading-logo-container">
			<img id="loading-logo" src="images/start_screen.jpg" />
		</div>

		<!-- <h1 id="loading-text">Loading...</h1> -->

		<div id="loading-bar" class="ldBar" data-value="0"></div>
	</section>

	<section id="start-screen">
		<button id="start-button">Play</button>
	</section>

	<section id="focus-warning-screen" style="display: none;">
		<div id="focus-warning-label">
			Click to focus...
		</div>
	</section>

	<div id="container">

		<div class="container_bg">
			<div id="solid"></div>
			<div id="gradient"></div>
		</div>

		<div id="container_3d"></div>
	</div>
	<button id="stopPreviewButton" onclick="window.stopPreview()">PREVIEWING</br>Reload Scene From Server</button>
	<script> var exports = {}; </script>
	<script type="text/javascript" src="./js/loading-bar.min.js"></script>
	<script type="text/javascript" src="./libs/jquery-2.1.4.js"></script>
	<script type="text/javascript" src="./libs/threejs/three.js"></script>
	<script type="text/javascript" src="./libs/threejs/FirstPersonControls.js"></script>
	<script type="module" src="./libs/threejs/PointerLockControls.js"></script>
	<script type="text/javascript" src="./libs/threejs/Detector.js"></script>
	<script type="text/javascript" src="./libs/threejs/SceneLoader.js"></script>
	<script type="module" src="./libs/threejs/GLTFLoader.js"></script>
	<script type="text/javascript" src="./libs/threejs/Pass.js"></script>
	<script type="text/javascript" src="./libs/threejs/ShaderPass.js"></script>
	<script type="text/javascript" src="./libs/threejs/EffectComposer.js"></script>
	<script type="text/javascript" src="./libs/threejs/RenderPass.js"></script>
	<script type="text/javascript" src="./libs/threejs/UnrealBloomPass.js"></script>
	<script type="text/javascript" src="./libs/threejs/shaders/LuminosityHighPassShader.js"></script>
	<script type="text/javascript" src="./libs/threejs/shaders/CopyShader.js"></script>
	<script type="text/javascript" src="./libs/threejs/shaders/FXAAShader.js"></script>
	<script type="text/javascript" src="./libs/threejs/shaders/GammaCorrectionShader.js"></script>

	<script type="text/javascript" src="./libs/cannon.min.js"></script>
	<!-- <script type="module" src="./libs/threejs/deprecated/Geometry.js"></script> -->
	<script type="module" src="./js/ConvexHull.js"></script>
	<script type="module" src="./js/ts/three-to-cannon/src/utils.js"></script>
	<script type="module" src="./js/ts/three-to-cannon/src/index.js"></script>

	<!-- <script type="text/javascript" src="./js/movement-pad.js"></script>
	<script type="text/javascript" src="./js/rotation-pad.js"></script> -->
	<!-- <script type="text/javascript" src="./js/touch-controls.js"></script> -->
	<script type="module" src="./js/touch-event-handler.js"></script>
	<!-- <script type="text/javascript" src="./js/ts/joystick/JoystickControls.js"></script> -->
	<script type="text/javascript" src="./js/point-and-click-controls.js"></script>
	<script type="module" src="./js/ts/fps-multiplatform-controls.js"></script>
	<script type="module" src="./js/ts/utils.js"></script>
	<script type="module" src="./js/ts/effects.js"></script>

	<script type="text/javascript">
		function pdef(e) {

			e.stopPropagation();
			e.preventDefault(); // prevent scrolling
			e.stopImmediatePropagation();
		}
		// window.addEventListener('touchstart', pdef, { passive: false });
		// window.addEventListener('touchend', pdef, { passive: false });
		// window.addEventListener('touchmove', pdef, { passive: false });

	</script>


	<script type="module">
		import { startScene } from './js/ts/example.js';
		import { isMobileBrowser } from './js/ts/utils.js';
		import { Storage as _Storage } from './threejs-source/editor/js/Storage.js';

		console.log('entry point');

		window.IS_MOBILE = isMobileBrowser();
		window.IS_DEV_BUILD = window.location.origin.includes('localhost');

		console.log('is mobile: ', window.IS_MOBILE);

		if (_Storage) {
			console.log('found storage');
			var storage = new _Storage();
			storage.init(function () {
				storage.getPreview(function (gltf) {

					if (gltf !== undefined) {
						window.previewGLTF = gltf;
						console.log("loaded!");
					}

					startScene();
				});
			});

			function stopPreview() {
				storage.clearPreview(function () {
					location.reload();
				});
			}
			window.stopPreview = stopPreview;
		} else {
			console.log('didnt find storage');
			startScene();
		}

	</script>

	<script type="module" src="./js/ts/example.js"></script>
</body>

</html>